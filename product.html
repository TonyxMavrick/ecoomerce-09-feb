<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - ElanWear</title>
  <meta name="description" content="View product details and add to cart.">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- Header Container -->
  <div id="header-container"></div>

  <!-- Main Content -->
  <main class="min-h-screen bg-white" id="product-container">
    <!-- Product will be rendered here -->
  </main>

  <!-- Footer Container -->
  <div id="footer-container"></div>

  <!-- Scripts -->
  <script src="js/products.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/common.js"></script>
  
  <script>
    let currentProduct = null;
    let selectedSize = '';
    let quantity = 1;

    document.addEventListener('DOMContentLoaded', function() {
      loadProduct();
      lucide.createIcons();
    });

    function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      
      if (!productId) {
        renderNotFound();
        return;
      }

      currentProduct = getProductById(productId);
      
      if (!currentProduct) {
        renderNotFound();
        return;
      }

      // Set default size if only one size available
      if (currentProduct.sizes && currentProduct.sizes.length === 1) {
        selectedSize = currentProduct.sizes[0];
      }

      renderProduct();
      lucide.createIcons();
    }

    function renderNotFound() {
      const container = document.getElementById('product-container');
      container.innerHTML = `
        <div class="flex items-center justify-center" style="min-height: 60vh;">
          <div class="text-center">
            <h2 class="text-2xl mb-4 font-medium">Product not found</h2>
            <a href="shop.html" class="text-neutral-600 hover:text-black">Return to shop</a>
          </div>
        </div>
      `;
    }

    function renderProduct() {
      const container = document.getElementById('product-container');
      const relatedProducts = products
        .filter(p => p.category === currentProduct.category && p.id !== currentProduct.id)
        .slice(0, 4);

      container.innerHTML = `
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
          <!-- Breadcrumb -->
          <div class="flex items-center gap-2 text-sm text-neutral-600 mb-8">
            <a href="index.html" class="hover:text-black">Home</a>
            <span>/</span>
            <a href="shop.html" class="hover:text-black">Shop</a>
            <span>/</span>
            <span class="text-black">${currentProduct.name}</span>
          </div>

          <!-- Product Details -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-20">
            <!-- Product Image -->
            <div class="aspect-[3/4] bg-neutral-100 overflow-hidden">
              <img src="${currentProduct.image}" alt="${currentProduct.name}" class="w-full h-full object-cover">
            </div>

            <!-- Product Info -->
            <div>
              <p class="text-sm text-neutral-500 mb-2">${currentProduct.category}</p>
              <h1 class="text-4xl mb-4 tracking-tight font-medium">${currentProduct.name}</h1>
              <p class="text-3xl mb-6 font-medium">$${currentProduct.price.toFixed(2)}</p>

              <div class="mb-8">
                <p class="text-neutral-700 leading-relaxed">${currentProduct.description}</p>
              </div>

              ${currentProduct.sizes && currentProduct.sizes.length > 0 ? `
                <div class="mb-6">
                  <label class="block mb-3 font-medium">Select Size</label>
                  <div class="flex flex-wrap gap-2" id="size-selector">
                    ${currentProduct.sizes.map(size => `
                      <button 
                        onclick="selectSize('${size}')" 
                        class="size-btn px-6 py-3 border transition-colors ${selectedSize === size ? 'border-black bg-black text-white' : 'border-neutral-300 hover:border-black'}"
                        data-size="${size}"
                      >
                        ${size}
                      </button>
                    `).join('')}
                  </div>
                </div>
              ` : ''}

              <!-- Quantity Selector -->
              <div class="mb-8">
                <label class="block mb-3 font-medium">Quantity</label>
                <div class="flex items-center gap-4">
                  <button onclick="updateQuantity(-1)" class="w-12 h-12 border border-neutral-300 hover:border-black transition-colors font-medium">
                    -
                  </button>
                  <span class="text-xl w-12 text-center font-medium" id="quantity-display">${quantity}</span>
                  <button onclick="updateQuantity(1)" class="w-12 h-12 border border-neutral-300 hover:border-black transition-colors font-medium">
                    +
                  </button>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="flex gap-4 mb-8">
                <button onclick="addToCart()" class="flex-1 bg-black text-white px-8 py-4 hover:bg-neutral-800 transition-colors flex items-center justify-center gap-2 font-medium">
                  <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                  Add to Cart
                </button>
                <button class="w-14 h-14 border border-neutral-300 hover:border-black transition-colors flex items-center justify-center">
                  <i data-lucide="heart" class="w-5 h-5"></i>
                </button>
              </div>

              <!-- Features -->
              <div class="space-y-4 border-t border-neutral-200 pt-8">
                <div class="flex items-start gap-3">
                  <i data-lucide="truck" class="w-5 h-5 mt-1 flex-shrink-0"></i>
                  <div>
                    <p class="font-medium">Fast & Free Shipping</p>
                    <p class="text-sm text-neutral-600">Free shipping on orders over $100</p>
                  </div>
                </div>
                <div class="flex items-start gap-3">
                  <i data-lucide="rotate-ccw" class="w-5 h-5 mt-1 flex-shrink-0"></i>
                  <div>
                    <p class="font-medium">Easy Returns</p>
                    <p class="text-sm text-neutral-600">30-day return policy</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Related Products -->
          ${relatedProducts.length > 0 ? `
            <div>
              <h2 class="text-3xl mb-8 tracking-tight font-medium">You May Also Like</h2>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                ${relatedProducts.map(product => `
                  <div class="product-card">
                    <a href="product.html?id=${product.id}" class="block group">
                      <div class="product-image-container mb-4 overflow-hidden">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                      </div>
                      <p class="text-sm text-neutral-500 mb-1">${product.category}</p>
                      <h3 class="font-medium mb-2 group-hover:text-neutral-600 transition-colors">${product.name}</h3>
                      <p class="text-lg font-medium">$${product.price.toFixed(2)}</p>
                    </a>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;

      lucide.createIcons();
    }

    function selectSize(size) {
      selectedSize = size;
      
      // Update button styles
      document.querySelectorAll('.size-btn').forEach(btn => {
        const btnSize = btn.getAttribute('data-size');
        if (btnSize === size) {
          btn.className = 'size-btn px-6 py-3 border transition-colors border-black bg-black text-white';
        } else {
          btn.className = 'size-btn px-6 py-3 border transition-colors border-neutral-300 hover:border-black';
        }
      });
    }

    function updateQuantity(change) {
      quantity = Math.max(1, quantity + change);
      document.getElementById('quantity-display').textContent = quantity;
    }

    function addToCart() {
      if (currentProduct.sizes && currentProduct.sizes.length > 1 && !selectedSize) {
        Toast.error('Please select a size');
        return;
      }

      const sizeToUse = selectedSize || (currentProduct.sizes && currentProduct.sizes[0]);
      cartManager.addToCart(currentProduct, quantity, sizeToUse);
      Toast.success(`${currentProduct.name} added to cart!`);
      
      // Update cart count in header
      updateCartCount();
    }
  </script>
</body>
</html>
